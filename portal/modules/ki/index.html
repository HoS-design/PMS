<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KI - Grundlagen und Anwendung</title>

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/app.css">

  <style>
    :root{
      --subject-color:#7c3aed;
      --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --soft:#f8fafc; --card:#ffffff;
      --good:#10b981; --bad:#ef4444; --shadow:0 12px 30px rgba(0,0,0,.08); --radius:18px; --max:1100px;
    }
    *{box-sizing:border-box}
    body{margin:0; color:var(--ink)}
    main{max-width:var(--max); margin:0 auto; padding:16px 14px 80px;}
    .wrap{display:grid; gap:14px;}
    .row{display:grid; gap:14px;}
    @media(min-width:920px){ .row.two{grid-template-columns: 1.15fr .85fr;} }

    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;}
    .card h2{margin:0 0 8px; font-size:1.12rem}
    .card h3{margin:14px 0 6px; font-size:1.02rem}
    .muted{color:var(--muted)}
    .hr{height:1px; background:var(--line); margin:14px 0}

    .pillbar{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 0}
    .pill{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--line); background:linear-gradient(180deg,#fff,var(--soft)); border-radius:999px; padding:7px 10px; font-size:.92rem;}
    .dot{width:10px; height:10px; border-radius:50%; background:var(--subject-color); box-shadow:0 0 0 3px rgba(124,58,237,.10);}

    .callout{border-left:4px solid var(--subject-color); background:linear-gradient(180deg,#fff,#faf5ff); padding:10px 12px; border-radius:14px; border:1px solid rgba(124,58,237,.20);}
    .rule{background:linear-gradient(180deg,#fff,var(--soft)); border:1px solid var(--line); border-radius:14px; padding:10px 12px;}

    .svgbox{border:1px dashed rgba(17,24,39,.25); border-radius:16px; padding:10px; background:linear-gradient(180deg,#fff,#fbfbff); overflow:auto;}
    svg{max-width:100%; height:auto; display:block}
    .svgcaption{margin-top:8px; font-size:.92rem; color:var(--muted)}

    .q{border:1px solid var(--line); border-radius:16px; padding:12px; background:#fff}
    .q + .q{margin-top:10px}
    .qtitle{font-weight:700; margin:0 0 10px}
    .opt{display:flex; gap:10px; align-items:flex-start; padding:8px 10px; border-radius:12px; border:1px solid var(--line); background:linear-gradient(180deg,#fff,var(--soft)); cursor:pointer}
    .opt input{margin-top:2px}
    .opt:hover{border-color:rgba(124,58,237,.35)}

    .feedback{margin-top:10px; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background:var(--soft)}
    .feedback.good{border-color:rgba(16,185,129,.35); background:rgba(16,185,129,.08)}
    .feedback.bad{border-color:rgba(239,68,68,.08); background:rgba(239,68,68,.06)}
    .mini-actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px}

    .field{display:grid; gap:6px; margin-top:10px}
    .field label{font-weight:600}
    .field input[type="text"], .field textarea, .field select{
      width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:14px; background:#fff; color:var(--ink); outline:none;
    }
    .field textarea{min-height:92px; resize:vertical}

    .btn{
      appearance:none; border:1px solid var(--line); background:linear-gradient(180deg,#fff,var(--soft));
      color:var(--ink); border-radius:14px; padding:10px 12px; cursor:pointer; font-weight:650; box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    .btn:hover{border-color:rgba(124,58,237,.35)}
    .btn.primary{border-color:rgba(124,58,237,.35); background:linear-gradient(180deg,#faf5ff,#f3e8ff);}
    .btn.danger{border-color:rgba(239,68,68,.35); background:linear-gradient(180deg,#fff1f2,#ffe4e6);}
    .btn:disabled{opacity:.55; cursor:not-allowed}

    .progress{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    .chip{border:1px solid var(--line); background:#fff; border-radius:999px; padding:6px 10px; font-size:.9rem; color:var(--muted);}
    .chip.ok{color:var(--ink); border-color:rgba(16,185,129,.35); background:rgba(16,185,129,.08)}
    .chip.warn{color:var(--ink); border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.10)}

    .lock{
      position:relative;
      opacity:.75;
      filter:saturate(.9);
    }
    .lock .lock-overlay{
      position:absolute; inset:0;
      border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(248,250,252,.85));
      display:flex; align-items:center; justify-content:center;
      padding:18px;
      text-align:center;
      border:1px solid rgba(229,231,235,.9);
    }
    .lock .lock-overlay .lock-card{
      max-width:560px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:0 10px 22px rgba(0,0,0,.08);
      padding:14px 14px;
    }
    .tiny-hint{
      margin-top:8px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:.92rem;
      color:var(--muted);
    }
    .hint-dot{
      width:8px; height:8px; border-radius:50%;
      background:rgba(124,58,237,.35);
      box-shadow:0 0 0 3px rgba(124,58,237,.08);
    }
  </style>
</head>

<body>
  <header class="app-header">
    <div class="brand-row">
      <img src="/chatisthisreal.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
      <div class="brand-title">
        <div class="badge-main">Informatik</div>
        <h1>KI - Grundlagen und Anwendung</h1>
      </div>
    </div>
    <div class="header-actions">
      <a href="/index.html" class="header-link">Startseite</a>
    </div>
  </header>

  <main>
    <div class="wrap">

      <section class="card">
        <h2>Uebersicht</h2>
        <p class="muted">
          Du arbeitest in vier Bloecken mit kurzen Uebungen. Jeder Block endet mit einem Mini-Check.
          Die Ueberpruefung am Ende wird freigeschaltet, wenn alle Mini-Checks abgeschlossen sind.
        </p>
        <div class="pillbar">
          <div class="pill"><span class="dot"></span> Begriffe sicher anwenden</div>
          <div class="pill"><span class="dot"></span> Daten und Modelle verstehen</div>
          <div class="pill"><span class="dot"></span> Qualitaet beurteilen</div>
          <div class="pill"><span class="dot"></span> Generative KI sinnvoll nutzen</div>
        </div>

        <div class="progress" id="progressChips">
          <div class="chip" data-chip="b1">Block 1</div>
          <div class="chip" data-chip="b2">Block 2</div>
          <div class="chip" data-chip="b3">Block 3</div>
          <div class="chip" data-chip="b4">Block 4</div>
          <div class="chip" data-chip="final">Ueberpruefung</div>
        </div>

        <div class="mini-actions">
          <button class="btn" id="btnRestore">Letzten Stand laden</button>
          <button class="btn danger" id="btnReset">Zuruecksetzen</button>
        </div>
        <p class="muted" style="margin-top:10px">
          Antworten werden lokal im Browser gespeichert (nur auf diesem Geraet).
        </p>
      </section>

      <!-- BLOCK 1 -->
      <section class="card" id="block1">
        <h2>Block 1: Was ist KI (und was nicht)?</h2>

        <div class="callout">
          <b>Kernidee:</b> KI ist ein Sammelbegriff. Viele moderne KI-Systeme basieren auf <b>Machine Learning</b>:
          Ein Modell lernt Muster aus Beispielen (Daten), statt nur fixe Regeln zu folgen.
        </div>

        <div class="row two" style="margin-top:14px">
          <div class="rule">
            <h3>Begriffe</h3>
            <ul>
              <li><b>KI:</b> Oberbegriff fuer Systeme, die intelligente Aufgaben loesen.</li>
              <li><b>Machine Learning:</b> Lernen aus Daten (Muster statt Regeln).</li>
              <li><b>Deep Learning:</b> ML mit vielen Schichten (Neural Networks).</li>
              <li><b>Training:</b> Modell wird angepasst.</li>
              <li><b>Inference:</b> Modell wird angewendet.</li>
            </ul>
          </div>

          <div class="svgbox">
            <svg viewBox="0 0 900 360" role="img" aria-label="KI Begriffe als Ebenen">
              <defs>
                <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0" stop-color="#ffffff"/>
                  <stop offset="1" stop-color="#f8fafc"/>
                </linearGradient>
              </defs>
              <rect x="20" y="20" width="860" height="320" rx="24" fill="url(#g1)" stroke="#e5e7eb"/>
              <rect x="60" y="70" width="780" height="90" rx="18" fill="#faf5ff" stroke="#e9d5ff"/>
              <rect x="110" y="180" width="680" height="70" rx="18" fill="#f3e8ff" stroke="#e9d5ff"/>
              <rect x="170" y="265" width="560" height="55" rx="18" fill="#ede9fe" stroke="#e9d5ff"/>
              <text x="90" y="125" font-size="28" font-family="system-ui" fill="#111827">KI (Artificial Intelligence)</text>
              <text x="140" y="225" font-size="26" font-family="system-ui" fill="#111827">Machine Learning</text>
              <text x="200" y="302" font-size="24" font-family="system-ui" fill="#111827">Deep Learning</text>
              <text x="60" y="55" font-size="16" font-family="system-ui" fill="#6b7280">Deep Learning ist Teil von ML, ML ist Teil von KI.</text>
            </svg>
            <div class="svgcaption">KI - ML - Deep Learning als Einordnung.</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Uebung 1: Kurzantwort</h3>
        <div class="q" id="b1_free">
          <p class="qtitle">Erklaere den Unterschied zwischen Training und Inference in 2-3 Saetzen.</p>
          <div class="field">
            <textarea id="b1_free_text" placeholder="Antwort ..."></textarea>
          </div>
          <div class="mini-actions">
            <button class="btn primary" data-check-free="b1_free">Pruefen</button>
            <button class="btn" data-solution="b1_free" disabled>Loesung</button>
          </div>
          <div class="feedback" data-feedback></div>
          <div class="tiny-hint"><span class="hint-dot"></span><span>Hinweis: knapp und praezise.</span></div>
        </div>

        <div class="hr"></div>

        <h3>Mini-Check 1 (MC)</h3>
        <div class="q" data-quiz="b1q1">
          <p class="qtitle">1) Was beschreibt Machine Learning am besten?</p>
          <label class="opt"><input type="radio" name="b1q1" value="a"> Ein Programm folgt nur festen Wenn-Dann-Regeln.</label>
          <label class="opt"><input type="radio" name="b1q1" value="b"> Ein Modell lernt Muster aus Beispielen und generalisiert auf neue Daten.</label>
          <label class="opt"><input type="radio" name="b1q1" value="c"> Ein Computer wird schneller, indem man mehr RAM einbaut.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b1q1" disabled>Loesung</button>
          </div>
        </div>

        <div class="q" data-quiz="b1q2">
          <p class="qtitle">2) Training und Inference passen am besten zu ...</p>
          <label class="opt"><input type="radio" name="b1q2" value="a"> Training = Anwenden, Inference = Anpassen.</label>
          <label class="opt"><input type="radio" name="b1q2" value="b"> Training = Zufall, Inference = RAM.</label>
          <label class="opt"><input type="radio" name="b1q2" value="c"> Training = Anpassen, Inference = Anwenden.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b1q2" disabled>Loesung</button>
          </div>
        </div>

        <div class="mini-actions">
          <button class="btn primary" data-check-block="block1">Mini-Check auswerten</button>
        </div>
        <div class="feedback" id="fbBlock1" aria-live="polite"></div>
      </section>

      <!-- BLOCK 2 -->
      <section class="card" id="block2">
        <h2>Block 2: Daten, Features, Labels, Bias</h2>

        <div class="row two" style="margin-top:10px">
          <div class="rule">
            <h3>Warum Datenqualitaet entscheidend ist</h3>
            <ul>
              <li><b>Garbage in, garbage out:</b> Schlechte Daten -> schlechte Ergebnisse.</li>
              <li><b>Features:</b> Messbare Merkmale (z.B. Laenge einer Nachricht).</li>
              <li><b>Labels:</b> Zielwerte (z.B. Spam / Kein Spam).</li>
              <li><b>Bias:</b> Systematische Verzerrung in Daten oder Auswahl.</li>
            </ul>
            <div class="callout" style="margin-top:10px">
              <b>Merksatz:</b> Ein Modell ist nur so fair und so gut wie die Daten, die es sieht.
            </div>
          </div>

          <div class="svgbox">
            <svg viewBox="0 0 900 380" role="img" aria-label="ML Pipeline">
              <rect x="20" y="20" width="860" height="340" rx="24" fill="#ffffff" stroke="#e5e7eb"/>
              <g font-family="system-ui" fill="#111827">
                <rect x="60" y="90" width="160" height="70" rx="16" fill="#f8fafc" stroke="#e5e7eb"/>
                <text x="95" y="132" font-size="20">Daten</text>
                <rect x="260" y="90" width="190" height="70" rx="16" fill="#faf5ff" stroke="#e9d5ff"/>
                <text x="292" y="132" font-size="20">Aufbereitung</text>
                <rect x="490" y="90" width="160" height="70" rx="16" fill="#f3e8ff" stroke="#e9d5ff"/>
                <text x="520" y="132" font-size="20">Training</text>
                <rect x="690" y="90" width="150" height="70" rx="16" fill="#ede9fe" stroke="#e9d5ff"/>
                <text x="720" y="132" font-size="20">Modell</text>
                <rect x="360" y="220" width="200" height="70" rx="16" fill="#f8fafc" stroke="#e5e7eb"/>
                <text x="408" y="262" font-size="20">Inference</text>
                <rect x="600" y="220" width="220" height="70" rx="16" fill="#f8fafc" stroke="#e5e7eb"/>
                <text x="628" y="262" font-size="20">Vorhersage</text>
                <path d="M220 125 H260" stroke="#111827" stroke-width="2"/>
                <path d="M450 125 H490" stroke="#111827" stroke-width="2"/>
                <path d="M650 125 H690" stroke="#111827" stroke-width="2"/>
                <path d="M765 160 C760 205, 610 205, 560 230" fill="none" stroke="#111827" stroke-width="2"/>
                <path d="M560 255 H600" stroke="#111827" stroke-width="2"/>
                <text x="60" y="60" font-size="16" fill="#6b7280">Von Rohdaten zur Vorhersage.</text>
              </g>
            </svg>
            <div class="svgcaption">Ablauf: Daten -> Training -> Modell -> Anwendung.</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Uebung 2: Zuweisung (Dropdown)</h3>
        <div class="q" id="b2_match">
          <p class="qtitle">Ordne zu.</p>

          <div class="field">
            <label>Feature</label>
            <select id="b2_m1">
              <option value="">Bitte waehlen ...</option>
              <option value="a">Zielwert (z.B. Spam)</option>
              <option value="b">Merkmal (z.B. Laenge)</option>
              <option value="c">Verzerrung (systematisch)</option>
            </select>
          </div>

          <div class="field">
            <label>Label</label>
            <select id="b2_m2">
              <option value="">Bitte waehlen ...</option>
              <option value="a">Zielwert (z.B. Spam)</option>
              <option value="b">Merkmal (z.B. Laenge)</option>
              <option value="c">Verzerrung (systematisch)</option>
            </select>
          </div>

          <div class="field">
            <label>Bias</label>
            <select id="b2_m3">
              <option value="">Bitte waehlen ...</option>
              <option value="a">Zielwert (z.B. Spam)</option>
              <option value="b">Merkmal (z.B. Laenge)</option>
              <option value="c">Verzerrung (systematisch)</option>
            </select>
          </div>

          <div class="mini-actions">
            <button class="btn primary" data-check-match="b2_match">Pruefen</button>
            <button class="btn" data-solution="b2_match" disabled>Loesung</button>
          </div>
          <div class="feedback" data-feedback></div>
        </div>

        <div class="hr"></div>

        <h3>Mini-Check 2 (MC)</h3>
        <div class="q" data-quiz="b2q1">
          <p class="qtitle">1) Was ist ein Label in einem ueberwachten Datensatz?</p>
          <label class="opt"><input type="radio" name="b2q1" value="a"> Eine zufaellige ID pro Zeile.</label>
          <label class="opt"><input type="radio" name="b2q1" value="b"> Der Zielwert, den das Modell lernen soll.</label>
          <label class="opt"><input type="radio" name="b2q1" value="c"> Eine Grafik.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b2q1" disabled>Loesung</button>
          </div>
        </div>

        <div class="q" data-quiz="b2q2">
          <p class="qtitle">2) Bias bedeutet am ehesten ...</p>
          <label class="opt"><input type="radio" name="b2q2" value="a"> mehr Rechenleistung.</label>
          <label class="opt"><input type="radio" name="b2q2" value="b"> eine systematische Verzerrung, die unfair machen kann.</label>
          <label class="opt"><input type="radio" name="b2q2" value="c"> dass Daten immer objektiv sind.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b2q2" disabled>Loesung</button>
          </div>
        </div>

        <div class="mini-actions">
          <button class="btn primary" data-check-block="block2">Mini-Check auswerten</button>
        </div>
        <div class="feedback" id="fbBlock2" aria-live="polite"></div>
      </section>

      <!-- BLOCK 3 -->
      <section class="card" id="block3">
        <h2>Block 3: Modelle, Training, Bewertung</h2>

        <div class="row two" style="margin-top:10px">
          <div class="rule">
            <h3>Wichtig</h3>
            <ul>
              <li><b>Overfitting:</b> Modell lernt Details aus Trainingsdaten, generalisiert aber schlecht.</li>
              <li><b>Accuracy:</b> Anteil korrekter Vorhersagen.</li>
              <li><b>Precision:</b> Wie viele als positiv erkannte Faelle sind wirklich positiv?</li>
              <li><b>Recall:</b> Wie viele echte positive Faelle wurden gefunden?</li>
            </ul>
            <div class="callout" style="margin-top:10px">
              <b>Merksatz:</b> Bei seltenen Ereignissen kann Accuracy taeuschen.
            </div>
          </div>

          <div class="svgbox">
            <svg viewBox="0 0 900 360" role="img" aria-label="Confusion Matrix">
              <rect x="20" y="20" width="860" height="320" rx="24" fill="#ffffff" stroke="#e5e7eb"/>
              <g font-family="system-ui">
                <text x="60" y="60" font-size="16" fill="#6b7280">Confusion Matrix</text>
                <rect x="170" y="95" width="520" height="220" rx="16" fill="#f8fafc" stroke="#e5e7eb"/>
                <line x1="430" y1="95" x2="430" y2="315" stroke="#e5e7eb"/>
                <line x1="170" y1="205" x2="690" y2="205" stroke="#e5e7eb"/>
                <text x="260" y="125" font-size="14" fill="#6b7280">Vorhergesagt: Positiv</text>
                <text x="500" y="125" font-size="14" fill="#6b7280">Vorhergesagt: Negativ</text>
                <text x="85" y="185" font-size="14" fill="#6b7280" transform="rotate(-90 85,185)">Tatsaechlich</text>
                <text x="85" y="205" font-size="14" fill="#6b7280">Positiv</text>
                <text x="85" y="315" font-size="14" fill="#6b7280">Negativ</text>
                <text x="285" y="185" font-size="24" fill="#111827">TP</text>
                <text x="545" y="185" font-size="24" fill="#111827">FN</text>
                <text x="285" y="295" font-size="24" fill="#111827">FP</text>
                <text x="545" y="295" font-size="24" fill="#111827">TN</text>
              </g>
            </svg>
            <div class="svgcaption">TP/FP/FN/TN als Basis fuer Precision und Recall.</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Uebung 3: Zuweisung</h3>
        <div class="q" id="b3_match">
          <p class="qtitle">Ordne zu: (positiv = "Betrug erkannt")</p>

          <div class="field">
            <label>False Positive (FP)</label>
            <select id="b3_m1">
              <option value="">Bitte waehlen ...</option>
              <option value="a">Betrug -> erkannt</option>
              <option value="b">Kein Betrug -> als Betrug erkannt</option>
              <option value="c">Betrug -> nicht erkannt</option>
              <option value="d">Kein Betrug -> korrekt nicht erkannt</option>
            </select>
          </div>

          <div class="field">
            <label>False Negative (FN)</label>
            <select id="b3_m2">
              <option value="">Bitte waehlen ...</option>
              <option value="a">Betrug -> erkannt</option>
              <option value="b">Kein Betrug -> als Betrug erkannt</option>
              <option value="c">Betrug -> nicht erkannt</option>
              <option value="d">Kein Betrug -> korrekt nicht erkannt</option>
            </select>
          </div>

          <div class="mini-actions">
            <button class="btn primary" data-check-match="b3_match">Pruefen</button>
            <button class="btn" data-solution="b3_match" disabled>Loesung</button>
          </div>
          <div class="feedback" data-feedback></div>
        </div>

        <div class="hr"></div>

        <h3>Mini-Check 3 (MC)</h3>
        <div class="q" data-quiz="b3q1">
          <p class="qtitle">1) Recall ist hoch, wenn ...</p>
          <label class="opt"><input type="radio" name="b3q1" value="a"> sehr wenige echte Positive gefunden werden.</label>
          <label class="opt"><input type="radio" name="b3q1" value="b"> ein grosser Anteil der echten Positiven erkannt wird.</label>
          <label class="opt"><input type="radio" name="b3q1" value="c"> das Modell keine Fehler macht.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b3q1" disabled>Loesung</button>
          </div>
        </div>

        <div class="q" data-quiz="b3q2">
          <p class="qtitle">2) Accuracy kann taeuschen, wenn ...</p>
          <label class="opt"><input type="radio" name="b3q2" value="a"> Klassen stark unausgeglichen sind.</label>
          <label class="opt"><input type="radio" name="b3q2" value="b"> man genug RAM hat.</label>
          <label class="opt"><input type="radio" name="b3q2" value="c"> Daten nie Fehler haben.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b3q2" disabled>Loesung</button>
          </div>
        </div>

        <div class="mini-actions">
          <button class="btn primary" data-check-block="block3">Mini-Check auswerten</button>
        </div>
        <div class="feedback" id="fbBlock3" aria-live="polite"></div>
      </section>

      <!-- BLOCK 4 -->
      <section class="card" id="block4">
        <h2>Block 4: Generative KI, Prompting, Quellencheck</h2>

        <div class="row two" style="margin-top:10px">
          <div class="rule">
            <h3>Generative KI</h3>
            <ul>
              <li>Erzeugt neue Inhalte (Text, Bilder, Code) anhand gelernter Muster.</li>
              <li>Kann plausibel wirken, auch wenn Inhalte falsch sind.</li>
              <li>Qualitaet steigt durch gutes Prompting und sorgfaeltiges Pruefen.</li>
            </ul>
            <h3>Prompt-Check</h3>
            <ol>
              <li><b>Rolle + Ziel</b></li>
              <li><b>Kontext</b></li>
              <li><b>Constraints</b> (Laenge, Struktur, Format)</li>
              <li><b>Pruefen</b> (Quellen, Unsicherheit markieren)</li>
            </ol>
          </div>

          <div class="svgbox">
            <svg viewBox="0 0 900 360" role="img" aria-label="Prompt Workflow">
              <rect x="20" y="20" width="860" height="320" rx="24" fill="#ffffff" stroke="#e5e7eb"/>
              <g font-family="system-ui">
                <text x="60" y="60" font-size="16" fill="#6b7280">Iterativer Workflow</text>
                <rect x="80" y="110" width="180" height="70" rx="16" fill="#faf5ff" stroke="#e9d5ff"/>
                <text x="110" y="152" font-size="20" fill="#111827">Prompt</text>
                <rect x="320" y="110" width="200" height="70" rx="16" fill="#f3e8ff" stroke="#e9d5ff"/>
                <text x="350" y="152" font-size="20" fill="#111827">Antwort</text>
                <rect x="580" y="110" width="240" height="70" rx="16" fill="#f8fafc" stroke="#e5e7eb"/>
                <text x="605" y="152" font-size="20" fill="#111827">Pruefen</text>
                <path d="M260 145 H320" stroke="#111827" stroke-width="2"/>
                <path d="M520 145 H580" stroke="#111827" stroke-width="2"/>
                <path d="M700 180 C700 260, 200 260, 170 180" fill="none" stroke="#111827" stroke-width="2"/>
              </g>
            </svg>
            <div class="svgcaption">Prompting ist ein Prozess: Ergebnis sichern durch Pruefen.</div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Uebung 4: Prompt schreiben</h3>
        <div class="q" id="b4_free">
          <p class="qtitle">Schreibe einen Prompt, der eine kurze Erklaerung erzeugen soll. Nutze Rolle, Kontext und Constraints.</p>
          <div class="field">
            <textarea id="b4_free_text" placeholder="Prompt ..."></textarea>
          </div>
          <div class="mini-actions">
            <button class="btn primary" data-check-free="b4_free">Pruefen</button>
            <button class="btn" data-solution="b4_free" disabled>Loesung</button>
          </div>
          <div class="feedback" data-feedback></div>
          <div class="tiny-hint"><span class="hint-dot"></span><span>Hinweis: Struktur hilft.</span></div>
        </div>

        <div class="hr"></div>

        <h3>Mini-Check 4 (MC)</h3>
        <div class="q" data-quiz="b4q1">
          <p class="qtitle">1) Warum ist Quellencheck wichtig?</p>
          <label class="opt"><input type="radio" name="b4q1" value="a"> Weil KI immer richtig liegt.</label>
          <label class="opt"><input type="radio" name="b4q1" value="b"> Weil Antworten plausibel wirken koennen, auch wenn sie falsch sind.</label>
          <label class="opt"><input type="radio" name="b4q1" value="c"> Weil man sonst laenger tippt.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b4q1" disabled>Loesung</button>
          </div>
        </div>

        <div class="q" data-quiz="b4q2">
          <p class="qtitle">2) Welcher Prompt ist voraussichtlich besser?</p>
          <label class="opt"><input type="radio" name="b4q2" value="a"> "Erklaer KI."</label>
          <label class="opt"><input type="radio" name="b4q2" value="b"> "Erklaere KI in 8 Bulletpoints, mit 1 Beispiel, und markiere Unsicherheiten."</label>
          <label class="opt"><input type="radio" name="b4q2" value="c"> "Mach irgendwas."</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="b4q2" disabled>Loesung</button>
          </div>
        </div>

        <div class="mini-actions">
          <button class="btn primary" data-check-block="block4">Mini-Check auswerten</button>
        </div>
        <div class="feedback" id="fbBlock4" aria-live="polite"></div>
      </section>

      <!-- FINAL (LOCKED UNTIL ALL MINI-CHECKS PASS) -->
      <section class="card lock" id="finalCard">
        <div class="lock-overlay" id="finalOverlay" aria-hidden="false">
          <div class="lock-card">
            <h2 style="margin:0 0 6px;">Ueberpruefung gesperrt</h2>
            <p class="muted" style="margin:0;">
              Freischaltung: schliesse alle Mini-Checks ab.
            </p>
          </div>
        </div>

        <h2>Ueberpruefung</h2>
        <p class="muted">
          Beantworte die Aufgaben. Am Ende kannst du eine Druckansicht oeffnen.
        </p>

        <div class="row two" style="margin-top:10px">
          <div class="rule">
            <h3>Teil A</h3>
            <div class="field">
              <label for="f_a1">Training vs. Inference (2-3 Saetze)</label>
              <textarea id="f_a1" placeholder="Antwort ..."></textarea>
            </div>
            <div class="field">
              <label for="f_a2">Nenne 2 Features und 1 Label (Beispiel)</label>
              <textarea id="f_a2" placeholder="Antwort ..."></textarea>
            </div>
          </div>

          <div class="rule">
            <h3>Teil B</h3>
            <div class="field">
              <label for="f_b1">Nenne 3 Massnahmen, um Antworten zu verbessern (Qualitaet/Sicherheit).</label>
              <textarea id="f_b1" placeholder="Antwort ..."></textarea>
            </div>
            <div class="field">
              <label for="f_b2">Schreibe einen Prompt mit Rolle, Kontext und Constraints.</label>
              <textarea id="f_b2" placeholder="Prompt ..."></textarea>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <h3>Teil C (MC)</h3>
        <div class="q" data-quiz="f1">
          <p class="qtitle">1) Bias in Daten kann dazu fuehren, dass ...</p>
          <label class="opt"><input type="radio" name="f1" value="a"> das Modell fairer wird.</label>
          <label class="opt"><input type="radio" name="f1" value="b"> bestimmte Gruppen systematisch benachteiligt werden.</label>
          <label class="opt"><input type="radio" name="f1" value="c"> die CPU weniger Strom braucht.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="f1" disabled>Loesung</button>
          </div>
        </div>

        <div class="q" data-quiz="f2">
          <p class="qtitle">2) Deep Learning ist ...</p>
          <label class="opt"><input type="radio" name="f2" value="a"> ein Teilbereich von ML mit vielen Schichten.</label>
          <label class="opt"><input type="radio" name="f2" value="b"> das gleiche wie Internet.</label>
          <label class="opt"><input type="radio" name="f2" value="c"> ein Betriebssystem.</label>
          <div class="feedback" data-feedback></div>
          <div class="mini-actions">
            <button class="btn" data-solution="f2" disabled>Loesung</button>
          </div>
        </div>

        <div class="mini-actions">
          <button class="btn primary" id="btnEvaluateFinal">Auswerten</button>
          <button class="btn" id="btnPrint">Druckansicht</button>
        </div>
        <div class="feedback" id="fbFinal" aria-live="polite"></div>
      </section>

    </div>
  </main>

  <script>
    (function(){
      "use strict";

      var KEY = "hos_pms_ki_v2";

      var ANSWERS = {
        b1q1: "b", b1q2: "c",
        b2q1: "b", b2q2: "b",
        b3q1: "b", b3q2: "a",
        b4q1: "b", b4q2: "b",
        f1: "b", f2: "a"
      };

      // Matching solutions
      var MATCH = {
        b2_match: { b2_m1:"b", b2_m2:"a", b2_m3:"c" },
        b3_match: { b3_m1:"b", b3_m2:"c" }
      };

      // Free-text soft checks (subtle output)
      function norm(s){
        return (s||"").toLowerCase()
          .replace(/[\u00e4]/g,"ae").replace(/[\u00f6]/g,"oe").replace(/[\u00fc]/g,"ue")
          .replace(/[\u00df]/g,"ss")
          .replace(/[^a-z0-9\s]/g," ")
          .replace(/\s+/g," ")
          .trim();
      }

      function loadState(){
        try{ return JSON.parse(localStorage.getItem(KEY) || "{}"); }catch(e){ return {}; }
      }
      function saveState(state){
        try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){}
      }

      function $(sel, root){ return (root||document).querySelector(sel); }
      function $all(sel, root){ return Array.prototype.slice.call((root||document).querySelectorAll(sel)); }

      function setChip(id, mode){
        var el = document.querySelector('[data-chip="'+id+'"]');
        if(!el) return;
        el.classList.remove("ok","warn");
        if(mode === "ok") el.classList.add("ok");
        if(mode === "warn") el.classList.add("warn");
      }

      function isBlockPassed(state, k){
        return !!(state.blocks && state.blocks[k] && state.blocks[k].pass);
      }

      function updateChips(state){
        setChip("b1", isBlockPassed(state,"block1") ? "ok" : (state.blocks && state.blocks.block1 ? "warn" : ""));
        setChip("b2", isBlockPassed(state,"block2") ? "ok" : (state.blocks && state.blocks.block2 ? "warn" : ""));
        setChip("b3", isBlockPassed(state,"block3") ? "ok" : (state.blocks && state.blocks.block3 ? "warn" : ""));
        setChip("b4", isBlockPassed(state,"block4") ? "ok" : (state.blocks && state.blocks.block4 ? "warn" : ""));
        setChip("final", state.final && state.final.done ? "ok" : (state.final ? "warn" : ""));
      }

      function setFeedback(el, ok, msg){
        if(!el) return;
        el.classList.remove("good","bad");
        el.textContent = msg || "";
        if(ok === true) el.classList.add("good");
        if(ok === false) el.classList.add("bad");
      }

      // Attempts: only count when content changed since last check
      function bumpAttempt(taskId, signature){
        var st = loadState();
        st.attempts = st.attempts || {};
        st.lastSig = st.lastSig || {};
        var prev = st.lastSig[taskId] || "";
        if(signature && signature !== prev){
          st.attempts[taskId] = (st.attempts[taskId] || 0) + 1;
          st.lastSig[taskId] = signature;
          saveState(st);
        }
        return (st.attempts[taskId] || 0);
      }

      function canShowSolution(taskId){
        var st = loadState();
        var n = (st.attempts && st.attempts[taskId]) ? st.attempts[taskId] : 0;
        return n >= 100;
      }

      function refreshSolutionButtons(){
        $all("[data-solution]").forEach(function(btn){
          var taskId = btn.getAttribute("data-solution");
          btn.disabled = !canShowSolution(taskId);
        });
      }

      function evalQuiz(groupId, countAttempt){
        var correct = ANSWERS[groupId];
        var sel = document.querySelector('input[name="'+groupId+'"]:checked');
        var box = document.querySelector('[data-quiz="'+groupId+'"]');
        var fb = box ? box.querySelector("[data-feedback]") : null;

        var sig = sel ? ("radio:"+groupId+":"+sel.value) : ("radio:"+groupId+":");
        if(countAttempt) bumpAttempt(groupId, sig);

        if(!sel){
          setFeedback(fb, false, "Eingabe speichern und nochmals pruefen.");
          refreshSolutionButtons();
          return { ok:false, chosen:null };
        }
        var ok = (sel.value === correct);
        // subtle feedback
        setFeedback(fb, ok ? null : null, ok ? "Ok." : "Nochmals pruefen.");
        refreshSolutionButtons();
        return { ok: ok, chosen: sel.value };
      }

      function evalMatch(matchId){
        var map = MATCH[matchId];
        var box = document.getElementById(matchId);
        var fb = box ? box.querySelector("[data-feedback]") : null;
        if(!map || !box){
          setFeedback(fb, false, "Eingabe speichern und nochmals pruefen.");
          return { ok:false };
        }

        var sigParts = [];
        var ok = true;
        Object.keys(map).forEach(function(selId){
          var el = document.getElementById(selId);
          var v = el ? (el.value || "") : "";
          sigParts.push(selId+"="+v);
          if(v !== map[selId]) ok = false;
        });

        bumpAttempt(matchId, "match:"+matchId+":"+sigParts.join("&"));
        setFeedback(fb, ok ? null : null, ok ? "Ok." : "Nochmals pruefen.");
        refreshSolutionButtons();
        return { ok: ok };
      }

      function evalFree(taskId){
        var box = document.getElementById(taskId);
        var fb = box ? box.querySelector("[data-feedback]") : null;
        var textEl = document.getElementById(taskId + "_text");
        var raw = textEl ? textEl.value : "";
        var t = norm(raw);

        bumpAttempt(taskId, "free:"+taskId+":"+t);

        // soft checks (subtle)
        var ok = true;

        if(taskId === "b1_free"){
          // require both concepts present + some length
          var hasTrain = /(train|anpass|lernen|parameter|gewicht)/.test(t);
          var hasInfer = /(infer|anwenden|vorhersag|nutzen|output)/.test(t);
          ok = (t.length >= 120 && hasTrain && hasInfer);
        } else if(taskId === "b4_free"){
          // prompt contains role+constraints signals
          var hasRole = /(rolle|du bist|agier|verhalte)/.test(t);
          var hasFormat = /(bullet|stichpunkt|absatz|tabelle|format|struktur)/.test(t);
          var hasConstraint = /(max|mind|saetze|woerter|laenge|kurz|8|10)/.test(t);
          ok = (t.length >= 140 && hasRole && (hasFormat || hasConstraint));
        } else {
          ok = (t.length >= 80);
        }

        setFeedback(fb, ok ? null : null, ok ? "Ok." : "Nochmals pruefen.");
        refreshSolutionButtons();
        return { ok: ok };
      }

      function bindOptionClick(){
        $all(".opt").forEach(function(lbl){
          lbl.addEventListener("click", function(){
            var input = lbl.querySelector("input");
            if(input && input.type === "radio"){
              input.checked = true;
              persistAll();
            }
          });
        });
      }

      function persistAll(){
        var st = loadState();
        st.radios = st.radios || {};
        Object.keys(ANSWERS).forEach(function(k){
          var sel = document.querySelector('input[name="'+k+'"]:checked');
          if(sel) st.radios[k] = sel.value;
        });

        st.selects = st.selects || {};
        Object.keys(MATCH).forEach(function(mid){
          Object.keys(MATCH[mid]).forEach(function(selId){
            var el = document.getElementById(selId);
            if(el) st.selects[selId] = el.value || "";
          });
        });

        st.text = st.text || {};
        ["b1_free_text","b4_free_text","f_a1","f_a2","f_b1","f_b2"].forEach(function(id){
          var el = document.getElementById(id);
          if(el) st.text[id] = el.value || "";
        });

        saveState(st);
        updateChips(st);
        refreshSolutionButtons();
        updateFinalLock(st);
      }

      function restoreAll(){
        var st = loadState();

        if(st.radios){
          Object.keys(st.radios).forEach(function(k){
            var v = st.radios[k];
            var input = document.querySelector('input[name="'+k+'"][value="'+v+'"]');
            if(input) input.checked = true;
          });
        }
        if(st.selects){
          Object.keys(st.selects).forEach(function(id){
            var el = document.getElementById(id);
            if(el) el.value = st.selects[id];
          });
        }
        if(st.text){
          Object.keys(st.text).forEach(function(id){
            var el = document.getElementById(id);
            if(el) el.value = st.text[id];
          });
        }

        updateChips(st);
        refreshSolutionButtons();
        updateFinalLock(st);
      }

      function scoreBlock(blockKey){
        var st = loadState();
        st.blocks = st.blocks || {};

        var okCount = 0;
        var total = 0;

        if(blockKey === "block1"){
          total += 2;
          if(evalQuiz("b1q1", true).ok) okCount++;
          if(evalQuiz("b1q2", true).ok) okCount++;
          var freeOk = evalFree("b1_free").ok;
          // require the free text to be non-empty (soft)
          var freeText = norm((document.getElementById("b1_free_text")||{}).value || "");
          var pass = (okCount >= 2) && freeOk && (freeText.length >= 40);
          st.blocks.block1 = { pass: pass };
          saveState(st);
          updateChips(st);
          updateFinalLock(st);
          return { pass: pass };
        }

        if(blockKey === "block2"){
          total += 2;
          if(evalQuiz("b2q1", true).ok) okCount++;
          if(evalQuiz("b2q2", true).ok) okCount++;
          var matchOk = evalMatch("b2_match").ok;
          var pass2 = (okCount >= 2) && matchOk;
          st.blocks.block2 = { pass: pass2 };
          saveState(st);
          updateChips(st);
          updateFinalLock(st);
          return { pass: pass2 };
        }

        if(blockKey === "block3"){
          total += 2;
          if(evalQuiz("b3q1", true).ok) okCount++;
          if(evalQuiz("b3q2", true).ok) okCount++;
          var matchOk3 = evalMatch("b3_match").ok;
          var pass3 = (okCount >= 2) && matchOk3;
          st.blocks.block3 = { pass: pass3 };
          saveState(st);
          updateChips(st);
          updateFinalLock(st);
          return { pass: pass3 };
        }

        if(blockKey === "block4"){
          total += 2;
          if(evalQuiz("b4q1", true).ok) okCount++;
          if(evalQuiz("b4q2", true).ok) okCount++;
          var freeOk4 = evalFree("b4_free").ok;
          var freeText4 = norm((document.getElementById("b4_free_text")||{}).value || "");
          var pass4 = (okCount >= 2) && freeOk4 && (freeText4.length >= 60);
          st.blocks.block4 = { pass: pass4 };
          saveState(st);
          updateChips(st);
          updateFinalLock(st);
          return { pass: pass4 };
        }

        return { pass:false };
      }

      function updateFinalLock(st){
        var overlay = document.getElementById("finalOverlay");
        var card = document.getElementById("finalCard");
        if(!overlay || !card) return;

        var unlocked = isBlockPassed(st,"block1") && isBlockPassed(st,"block2") && isBlockPassed(st,"block3") && isBlockPassed(st,"block4");
        overlay.style.display = unlocked ? "none" : "flex";
        overlay.setAttribute("aria-hidden", unlocked ? "true" : "false");
        if(unlocked){
          card.classList.remove("lock");
        }else{
          card.classList.add("lock");
        }

        // Disable final inputs/buttons when locked (hard)
        $all("#finalCard textarea, #finalCard input, #finalCard button").forEach(function(el){
          if(el.id === "btnPrint" || el.id === "btnEvaluateFinal") {
            el.disabled = !unlocked;
          } else if(el.hasAttribute("data-solution")){
            el.disabled = true; // solutions still gated by attempts
          } else {
            el.disabled = !unlocked;
          }
        });

        // solution gating refresh after lock application
        refreshSolutionButtons();
        // keep final solution buttons gated + also require unlocked
        if(!unlocked){
          $all("#finalCard [data-solution]").forEach(function(b){ b.disabled = true; });
        }
      }

      function bindMiniChecks(){
        $all("[data-check-block]").forEach(function(btn){
          btn.addEventListener("click", function(){
            var id = btn.getAttribute("data-check-block");
            var r = scoreBlock(id);
            var out = document.getElementById("fb" + id.charAt(0).toUpperCase() + id.slice(1));
            setFeedback(out, null, r.pass ? "Ok." : "Nochmals pruefen.");
          });
        });
      }

      function bindMatchChecks(){
        $all("[data-check-match]").forEach(function(btn){
          btn.addEventListener("click", function(){
            var mid = btn.getAttribute("data-check-match");
            evalMatch(mid);
            persistAll();
          });
        });
      }

      function bindFreeChecks(){
        $all("[data-check-free]").forEach(function(btn){
          btn.addEventListener("click", function(){
            var tid = btn.getAttribute("data-check-free");
            evalFree(tid);
            persistAll();
          });
        });
      }

      function bindSolutions(){
        $all("[data-solution]").forEach(function(btn){
          btn.addEventListener("click", function(){
            var taskId = btn.getAttribute("data-solution");
            if(!canShowSolution(taskId)) return;

            // solution rendering is minimal and only on demand
            if(taskId === "b1_free"){
              alert("Training: Modell wird anhand von Beispielen angepasst (Parameter/Gewichte werden optimiert). Inference: das trainierte Modell wird auf neue Eingaben angewendet und liefert eine Vorhersage.");
              return;
            }
            if(taskId === "b4_free"){
              alert("Beispiel:\nDu bist eine Lehrperson. Erklaere das Thema 'Bias in Trainingsdaten' in 6 Bulletpoints. Nutze einfache Sprache, nenne 1 Beispiel und markiere Unsicherheiten. Laenge: max. 120 Woerter.");
              return;
            }
            if(taskId === "b2_match"){
              alert("Feature -> Merkmal (z.B. Laenge)\nLabel -> Zielwert (z.B. Spam)\nBias -> Verzerrung (systematisch)");
              return;
            }
            if(taskId === "b3_match"){
              alert("FP -> Kein Betrug, aber als Betrug erkannt\nFN -> Betrug, aber nicht erkannt");
              return;
            }
            if(ANSWERS[taskId]){
              alert("Richtige Antwort: " + ANSWERS[taskId].toUpperCase());
              return;
            }
          });
        });
      }

      function bindFinal(){
        var btn = document.getElementById("btnEvaluateFinal");
        if(btn){
          btn.addEventListener("click", function(){
            var st = loadState();
            // Count attempts only when changed
            evalQuiz("f1", true);
            evalQuiz("f2", true);

            var okCount = 0;
            if(evalQuiz("f1", false).ok) okCount++;
            if(evalQuiz("f2", false).ok) okCount++;

            // soft completeness
            var miss = 0;
            ["f_a1","f_a2","f_b1","f_b2"].forEach(function(id){
              var v = norm((document.getElementById(id)||{}).value || "");
              if(v.length < 30) miss++;
              bumpAttempt("final_"+id, v); // counts only if changed
            });

            st.final = st.final || {};
            st.final.done = true;
            saveState(st);
            updateChips(st);
            refreshSolutionButtons();

            var msg = "Ok.";
            if(okCount < 2 || miss > 0) msg = "Nochmals pruefen.";
            setFeedback(document.getElementById("fbFinal"), null, msg);
          });
        }

        var pr = document.getElementById("btnPrint");
        if(pr){
          pr.addEventListener("click", function(){
            // simple print; browser can save as PDF
            window.print();
          });
        }
      }

      function bindPersistInputs(){
        $all("textarea, input[type='text'], select").forEach(function(el){
          el.addEventListener("input", function(){ persistAll(); });
          el.addEventListener("change", function(){ persistAll(); });
        });
        $all("input[type='radio']").forEach(function(el){
          el.addEventListener("change", function(){ persistAll(); });
        });
      }

      function bindReset(){
        var btn = document.getElementById("btnReset");
        if(btn){
          btn.addEventListener("click", function(){
            try{ localStorage.removeItem(KEY); }catch(e){}
            location.reload();
          });
        }
      }

      function bindRestore(){
        var btn = document.getElementById("btnRestore");
        if(btn){
          btn.addEventListener("click", function(){
            restoreAll();
            setFeedback(document.getElementById("fbFinal"), null, "Ok.");
          });
        }
      }

      // Init
      bindOptionClick();
      bindMiniChecks();
      bindMatchChecks();
      bindFreeChecks();
      bindSolutions();
      bindFinal();
      bindPersistInputs();
      bindReset();
      bindRestore();
      restoreAll();
      // Ensure lock state applied on load
      updateFinalLock(loadState());
      // Solution buttons hidden-gated
      refreshSolutionButtons();
    })();
  </script>
</body>
</html>
