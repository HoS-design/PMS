<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Montessori ‚Äì Wortarten-Symbole zuordnen (HoS)</title>
  <style>
    :root{
      --ink:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --soft:#f8fafc;
      --card:#ffffff;
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --radius:18px;

      --noun:#111827;         /* Nomen: schwarz */
      --article:#93c5fd;      /* Artikel: hellblau */
      --adj:#2563eb;          /* Adjektiv: blau */
      --verb:#ef4444;         /* Verb: rot */
      --adv:#f59e0b;          /* Adverb: orange */
      --pron:#7c3aed;         /* Pronomen: lila */
      --prep:#22c55e;         /* Pr√§position: gr√ºn */
      --conj:#ec4899;         /* Konjunktion: rosa */
      --interj:#fbbf24;       /* Interjektion: gold */

      --ok:#10b981;
      --bad:#ef4444;
      --warn:#f59e0b;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,#ffffff, #f7fafc);
    }

    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 30px}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 14px; border:1px solid var(--line); border-radius:22px;
      background:rgba(255,255,255,.85); box-shadow:var(--shadow); backdrop-filter: blur(6px);
      position:sticky; top:10px; z-index:10;
    }
    .brand{display:flex; gap:14px; align-items:center; min-width:260px}
    .meme{
      width:56px;height:56px;border-radius:16px;object-fit:cover;border:1px solid var(--line);
      background:#fff;
    }
    .titlebox h1{font-size:18px;margin:0 0 4px 0}
    .titlebox p{margin:0;color:var(--muted);font-size:13px}
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line); background:#fff;
      font-size:12px; color:var(--muted);
      white-space:nowrap;
    }
    .badge b{color:var(--ink)}
    .top-actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      padding:10px 12px;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(17,24,39,.06);
      transition:transform .05s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{background:#f3f4f6}
    .btn:active{transform:translateY(1px)}
    .btn.primary{border-color:#c7d2fe;background:#eef2ff}
    .btn.primary:hover{background:#e0e7ff}
    .btn.good{border-color:#bbf7d0;background:#ecfdf5}
    .btn.warn{border-color:#fde68a;background:#fffbeb}
    .btn.ghost{background:transparent; box-shadow:none}

    main{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 920px){
      main{grid-template-columns: 1fr; }
      header{position:relative; top:auto}
      .brand{min-width:auto}
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{font-size:14px;margin:0 0 10px 0}
    .sub{color:var(--muted);font-size:13px;margin:6px 0 0}

    .sentence{
      display:flex;
      flex-wrap:wrap;
      gap:10px 8px;
      padding:12px;
      border:1px dashed var(--line);
      border-radius:16px;
      background:var(--soft);
      align-items:flex-end;
      min-height:120px;
    }

    .tok{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
      padding:6px 6px 8px;
      border-radius:14px;
      border:1px solid transparent;
      min-width:44px;
    }
    .tok.word{
      background:#fff;
      border-color:var(--line);
    }
    .tok.punct{
      padding:0 2px 6px;
      min-width:auto;
    }
    .tok .w{
      font-size:16px;
      font-weight:650;
      cursor:pointer;
      padding:6px 10px;
      border-radius:12px;
      border:1px solid transparent;
      user-select:none;
      white-space:nowrap;
    }
    .tok.word .w:hover{border-color:#dbeafe;background:#eff6ff}
    .tok.word.selected .w{border-color:#93c5fd;background:#eff6ff}

    .slot{
      width:44px;height:40px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      display:grid;place-items:center;
      position:relative;
    }
    .slot.ok{border-color:#86efac; box-shadow:0 0 0 3px rgba(16,185,129,.12) inset}
    .slot.bad{border-color:#fecaca; box-shadow:0 0 0 3px rgba(239,68,68,.10) inset}
    .slot .mini{
      width:28px;height:28px;
      opacity:.95;
      pointer-events:none;
    }

    .palette{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    .sym{
      display:flex; align-items:center; gap:10px;
      padding:10px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      cursor:grab;
      user-select:none;
    }
    .sym:active{cursor:grabbing}
    .sym .label{font-weight:700;font-size:13px}
    .sym .hint{font-size:12px;color:var(--muted);margin-top:2px}
    .sym .stack{display:flex;flex-direction:column;line-height:1.15}
    .sym.selected{
      outline:3px solid rgba(59,130,246,.25);
      border-color:#bfdbfe;
      background:#eff6ff;
    }
    .sym svg{width:34px;height:34px;flex:0 0 auto}

    .status{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      margin-top:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:#fff;
    }
    .status .left{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .pill{
      padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fff;font-size:12px;color:var(--muted);
    }
    .msg{font-size:13px;color:var(--muted)}
    .msg b{color:var(--ink)}
    .kbd{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      border:1px solid var(--line);
      padding:2px 6px;border-radius:8px;background:#fff;color:var(--muted);
      font-size:12px;
    }

    .legend{
      margin-top:10px;
      border-top:1px solid var(--line);
      padding-top:10px;
      display:grid;
      grid-template-columns: 1fr;
      gap:6px;
    }
    .legend-row{
      display:flex; align-items:center; gap:10px;
      font-size:12px; color:var(--muted);
    }
    .legend-row svg{width:20px;height:20px}
    .footer{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-top:12px; color:var(--muted); font-size:12px;
    }
    a{color:inherit}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="chatisthisreal.png" onerror="this.onerror=null;this.src='chatisthisreal.png';" alt="Chat is this real?" class="meme">
        <div class="titlebox">
          <h1>Montessori ‚Äì Wortarten-Symbole zuordnen</h1>
          <p>Drag & Drop oder Symbol ausw√§hlen ‚Üí Wort anklicken</p>
        </div>
      </div>

      <div class="badge">üß© Zuordnung ‚Ä¢ <b>Wortarten</b> ‚Ä¢ HoS</div>

      <div class="top-actions">
        <button class="btn ghost" id="homeBtn" title="Zur Startseite">üè† Startseite</button>
        <button class="btn warn" id="newBtn" title="Neu mischen / neu beginnen">üîÅ Neu</button>
        <button class="btn primary" id="nextBtn" title="N√§chster Satz">‚û°Ô∏è N√§chster Satz</button>
        <button class="btn good" id="checkBtn" title="√úberpr√ºfen">‚úÖ Pr√ºfen</button>
        <button class="btn" id="solveBtn" title="L√∂sung anzeigen">üß† L√∂sung</button>
      </div>
    </header>

    <main>
      <!-- LEFT: Sentence -->
      <section class="card">
        <h2>Satz</h2>
        <div class="sub">Tipp: Mit <span class="kbd">1‚Äì9</span> kannst du ein Symbol w√§hlen. Mit <span class="kbd">Esc</span> Auswahl entfernen.</div>

        <div id="sentence" class="sentence" aria-label="Satz mit W√∂rtern"></div>

        <div class="status">
          <div class="left">
            <div class="pill">Satz: <b id="idx">1</b>/<span id="total">1</span></div>
            <div class="pill">Punkte: <b id="score">0</b></div>
            <div class="pill">Richtig: <b id="right">0</b></div>
            <div class="pill">Falsch: <b id="wrong">0</b></div>
          </div>
          <div class="msg" id="msg">W√§hle ein Symbol und ordne es den W√∂rtern zu.</div>
        </div>

        <div class="footer">
          <div>HoS ‚Ä¢ Montessori-Symbole (vereinfachte Schulversion)</div>
          <div>Bedienung: Ziehen oder klicken</div>
        </div>
      </section>

      <!-- RIGHT: Palette -->
      <aside class="card">
        <h2>Symbol-Auswahl</h2>
        <div class="sub">Ziehe ein Symbol auf ein Wort <b>oder</b> klicke ein Symbol an und dann das Wort.</div>

        <div class="palette" id="palette"></div>

        <div class="legend" id="legend"></div>
      </aside>
    </main>
  </div>

<script>
/* -----------------------------
   Montessori-Symbole (SVG)
------------------------------ */
const SYMBOLS = [
  { key:"N",  name:"Nomen",         hint:"Dinge/Namen",        colorVar:"--noun",    draw:"triangle" },
  { key:"ART",name:"Artikel",       hint:"Begleiter",          colorVar:"--article", draw:"triangleSmall" },
  { key:"ADJ",name:"Adjektiv",      hint:"Wie ist es?",        colorVar:"--adj",     draw:"triangleMid" },
  { key:"V",  name:"Verb",          hint:"Tun/Handlung",       colorVar:"--verb",    draw:"circle" },
  { key:"ADV",name:"Adverb",        hint:"Wie/Wann/Wo?",       colorVar:"--adv",     draw:"circleSmall" },
  { key:"PRO",name:"Pronomen",      hint:"Stellvertreter",     colorVar:"--pron",    draw:"trianglePron" },
  { key:"PR√ÑP",name:"Pr√§position",  hint:"Beziehung/Lage",     colorVar:"--prep",    draw:"crescent" },
  { key:"KONJ",name:"Konjunktion",  hint:"Verbindet",          colorVar:"--conj",    draw:"bar" },
  { key:"INT",name:"Interjektion",  hint:"Ausruf",             colorVar:"--interj",  draw:"star" }
];

function svgFor(sym, size=34){
  const color = getComputedStyle(document.documentElement).getPropertyValue(sym.colorVar).trim();
  const s = size;
  const view = `0 0 100 100`;

  const tri = (scale=1, yOffset=0) => {
    const cx=50, cy=52+yOffset;
    const w=70*scale, h=64*scale;
    const p1 = `${cx},${cy-h/2}`;
    const p2 = `${cx-w/2},${cy+h/2}`;
    const p3 = `${cx+w/2},${cy+h/2}`;
    return `<polygon points="${p1} ${p2} ${p3}" fill="${color}" />`;
  };

  const circle = (r=34) => `<circle cx="50" cy="52" r="${r}" fill="${color}" />`;

  const crescent = () => `
    <path d="M63 20
             A30 30 0 1 0 63 84
             A22 30 0 1 1 63 20 Z"
          fill="${color}" opacity="1"/>
    <path d="M71 24
             A24 28 0 1 0 71 80
             A18 28 0 1 1 71 24 Z"
          fill="white" opacity="0.92"/>
  `;

  const bar = () => `<rect x="18" y="44" width="64" height="18" rx="9" fill="${color}" />`;

  const star = () => `
    <path d="M50 16 L58 38 L82 38 L62 52 L70 76 L50 62 L30 76 L38 52 L18 38 L42 38 Z"
          fill="${color}" />
  `;

  let shape = "";
  switch(sym.draw){
    case "triangle": shape = tri(1.0, 0); break;
    case "triangleSmall": shape = tri(0.72, 4); break;
    case "triangleMid": shape = tri(0.86, 2); break;
    case "trianglePron": shape = tri(0.86, 2); break;
    case "circle": shape = circle(32); break;
    case "circleSmall": shape = circle(24); break;
    case "crescent": shape = crescent(); break;
    case "bar": shape = bar(); break;
    case "star": shape = star(); break;
  }

  return `
    <svg width="${s}" height="${s}" viewBox="${view}" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      ${shape}
    </svg>
  `;
}

/* -----------------------------
   Aufgaben (S√§tze + L√∂sungen)
   (Token-Index bezieht sich NUR
   auf W√∂rter, nicht auf Satzzeichen)
------------------------------ */
const EXERCISES = [
  {
    sentence: "Der kluge Hund l√§uft heute schnell durch den Park.",
    // words: Der(ART) kluge(ADJ) Hund(N) l√§uft(V) heute(ADV) schnell(ADV) durch(PR√ÑP) den(ART) Park(N)
    types: ["ART","ADJ","N","V","ADV","ADV","PR√ÑP","ART","N"]
  },
  {
    sentence: "Ich sehe einen gro√üen Ball und du wirfst ihn hoch!",
    // Ich(PRO) sehe(V) einen(ART) gro√üen(ADJ) Ball(N) und(KONJ) du(PRO) wirfst(V) ihn(PRO) hoch(ADV)
    types: ["PRO","V","ART","ADJ","N","KONJ","PRO","V","PRO","ADV"]
  },
  {
    sentence: "Wow, das ist wirklich sehr spannend.",
    // Wow(INT) das(PRO) ist(V) wirklich(ADV) sehr(ADV) spannend(ADJ)
    types: ["INT","PRO","V","ADV","ADV","ADJ"]
  },
  {
    sentence: "Meine Schwester liest leise im Zug, aber ich telefoniere nicht.",
    // Meine(PRO) Schwester(N) liest(V) leise(ADV) im(PR√ÑP) Zug(N) aber(KONJ) ich(PRO) telefoniere(V) nicht(ADV)
    types: ["PRO","N","V","ADV","PR√ÑP","N","KONJ","PRO","V","ADV"]
  },
  {
    sentence: "Der Lehrer erkl√§rt die neue Regel mit Geduld.",
    // Der(ART) Lehrer(N) erkl√§rt(V) die(ART) neue(ADJ) Regel(N) mit(PR√ÑP) Geduld(N)
    types: ["ART","N","V","ART","ADJ","N","PR√ÑP","N"]
  },
  {
    sentence: "Sie kommt morgen zu uns, weil wir √ºben m√ºssen.",
    // Sie(PRO) kommt(V) morgen(ADV) zu(PR√ÑP) uns(PRO) weil(KONJ) wir(PRO) √ºben(V) m√ºssen(V)
    // (Modalverb als Verb gez√§hlt)
    types: ["PRO","V","ADV","PR√ÑP","PRO","KONJ","PRO","V","V"]
  },
  {
    sentence: "Ein kleines Kind spielt fr√∂hlich neben dem Brunnen.",
    // Ein(ART) kleines(ADJ) Kind(N) spielt(V) fr√∂hlich(ADV) neben(PR√ÑP) dem(ART) Brunnen(N)
    types: ["ART","ADJ","N","V","ADV","PR√ÑP","ART","N"]
  },
  {
    sentence: "Du bist heute m√ºde, deshalb lernst du sp√§ter.",
    // Du(PRO) bist(V) heute(ADV) m√ºde(ADJ) deshalb(KONJ) lernst(V) du(PRO) sp√§ter(ADV)
    types: ["PRO","V","ADV","ADJ","KONJ","V","PRO","ADV"]
  },
  {
    sentence: "Die rote Jacke liegt auf dem Stuhl.",
    // Die(ART) rote(ADJ) Jacke(N) liegt(V) auf(PR√ÑP) dem(ART) Stuhl(N)
    types: ["ART","ADJ","N","V","PR√ÑP","ART","N"]
  },
  {
    sentence: "Aua! Meine Hand tut sehr weh.",
    // Aua(INT) Meine(PRO) Hand(N) tut(V) sehr(ADV) weh(ADV)
    types: ["INT","PRO","N","V","ADV","ADV"]
  }
];

document.getElementById("total").textContent = EXERCISES.length;

/* -----------------------------
   App State
------------------------------ */
let current = 0;
let selectedSymbolKey = null; // e.g., "N", "V" ... (actually SYMBOLS.key)
let score = 0;
let lastCheck = { right:0, wrong:0 };

/* -----------------------------
   Rendering Palette
------------------------------ */
const paletteEl = document.getElementById("palette");
const legendEl  = document.getElementById("legend");

function renderPalette(){
  paletteEl.innerHTML = "";
  legendEl.innerHTML = "";

  SYMBOLS.forEach((s, idx) => {
    const item = document.createElement("div");
    item.className = "sym";
    item.setAttribute("draggable","true");
    item.dataset.sym = s.key;
    item.innerHTML = `
      ${svgFor(s, 34)}
      <div class="stack">
        <div class="label">${s.name}</div>
        <div class="hint">${s.hint}</div>
      </div>
    `;

    // Drag start
    item.addEventListener("dragstart", (ev) => {
      ev.dataTransfer.setData("text/plain", s.key);
      ev.dataTransfer.effectAllowed = "copy";
      setSelectedSymbol(s.key);
    });

    // Click to select
    item.addEventListener("click", () => setSelectedSymbol(s.key));

    paletteEl.appendChild(item);

    // Legend mini
    const lr = document.createElement("div");
    lr.className = "legend-row";
    lr.innerHTML = `${svgFor(s, 20)} <span><b>${s.name}</b> (${s.key})</span>`;
    legendEl.appendChild(lr);

    // Keyboard mapping 1-9
    item.title = `Taste ${idx+1}`;
  });
}
renderPalette();

function setSelectedSymbol(symKey){
  selectedSymbolKey = symKey;

  // UI highlight
  document.querySelectorAll(".sym").forEach(el=>{
    el.classList.toggle("selected", el.dataset.sym === symKey);
  });

  const s = SYMBOLS.find(x=>x.key===symKey);
  document.getElementById("msg").innerHTML = s
    ? `Ausgew√§hlt: <b>${s.name}</b>. Jetzt Wort anklicken oder Symbol ziehen.`
    : `W√§hle ein Symbol und ordne es den W√∂rtern zu.`;
}

/* -----------------------------
   Sentence parsing
------------------------------ */
const sentenceEl = document.getElementById("sentence");

function tokenize(sentence){
  // Split into words & punctuation while keeping punctuation as separate tokens
  // Words include umlauts, √ü, and apostrophes/hyphens inside.
  const re = /([A-Za-z√Ñ√ñ√ú√§√∂√º√ü]+(?:[-‚Äô'][A-Za-z√Ñ√ñ√ú√§√∂√º√ü]+)*)|([0-9]+)|([^\sA-Za-z√Ñ√ñ√ú√§√∂√º√ü0-9])/g;
  const out = [];
  let m;
  while((m=re.exec(sentence))!==null){
    if(m[1] || m[2]){
      out.push({ kind:"word", text:(m[1]||m[2]) });
    }else if(m[3]){
      out.push({ kind:"punct", text:m[3] });
    }
  }
  return out;
}

function loadExercise(i){
  current = (i + EXERCISES.length) % EXERCISES.length;
  document.getElementById("idx").textContent = current+1;
  document.getElementById("right").textContent = "0";
  document.getElementById("wrong").textContent = "0";
  lastCheck = { right:0, wrong:0 };

  const ex = EXERCISES[current];
  const tokens = tokenize(ex.sentence);

  sentenceEl.innerHTML = "";
  selectedSymbolKey = null;
  setSelectedSymbol(null);

  // Word index for solution mapping
  let wIndex = 0;

  tokens.forEach((t) => {
    if(t.kind === "punct"){
      const p = document.createElement("div");
      p.className = "tok punct";
      p.innerHTML = `<div class="w" style="cursor:default;padding:0 2px;border:none;background:transparent">${escapeHtml(t.text)}</div>`;
      sentenceEl.appendChild(p);
      return;
    }

    const correctType = ex.types[wIndex] || null;

    const wrap = document.createElement("div");
    wrap.className = "tok word";
    wrap.dataset.wi = String(wIndex);
    wrap.dataset.correct = correctType; // e.g., "ART"
    wrap.dataset.assigned = "";         // assigned SYMBOLS.key (like "N", "V"...) or empty

    wrap.innerHTML = `
      <div class="w" role="button" tabindex="0">${escapeHtml(t.text)}</div>
      <div class="slot" aria-label="Symbol-Ablage"></div>
    `;

    const wordBtn = wrap.querySelector(".w");
    const slot = wrap.querySelector(".slot");

    // Click word to assign selected symbol
    const assignFromSelection = () => {
      if(!selectedSymbolKey) return;
      assignSymbolToWord(wrap, selectedSymbolKey);
    };

    wordBtn.addEventListener("click", () => {
      // Toggle selection outline for clarity
      document.querySelectorAll(".tok.word").forEach(x=>x.classList.remove("selected"));
      wrap.classList.add("selected");
      assignFromSelection();
    });

    wordBtn.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        wordBtn.click();
      }
    });

    // Slot accepts drop
    slot.addEventListener("dragover", (ev) => {
      ev.preventDefault();
      slot.style.background = "#eff6ff";
    });
    slot.addEventListener("dragleave", () => {
      slot.style.background = "#fff";
    });
    slot.addEventListener("drop", (ev) => {
      ev.preventDefault();
      slot.style.background = "#fff";
      const symKey = ev.dataTransfer.getData("text/plain");
      if(symKey) assignSymbolToWord(wrap, symKey);
    });

    sentenceEl.appendChild(wrap);
    wIndex++;
  });

  // sanity check length
  // (If punctuation differences cause mismatch, it's okay; we map only word tokens.)
  document.getElementById("msg").innerHTML = `Ordne die Symbole zu. Tipp: Taste <span class="kbd">1</span> w√§hlt das 1. Symbol usw.`;
}

function assignSymbolToWord(wordEl, symKey){
  const slot = wordEl.querySelector(".slot");
  const sym = SYMBOLS.find(s=>s.key === symKey);
  if(!sym) return;

  // Put mini svg
  slot.innerHTML = `<div class="mini">${svgFor(sym, 28)}</div>`;
  wordEl.dataset.assigned = symKey;

  // Clear check styling until next check
  slot.classList.remove("ok","bad");
}

function clearAssignments(){
  document.querySelectorAll(".tok.word").forEach(w=>{
    w.dataset.assigned = "";
    w.classList.remove("selected");
    const slot = w.querySelector(".slot");
    slot.classList.remove("ok","bad");
    slot.innerHTML = "";
  });
  setSelectedSymbol(null);
  document.getElementById("msg").textContent = "Neu gestartet. Ordne die Symbole zu.";
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, (c)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}

/* -----------------------------
   Checking & Solving
------------------------------ */
// Map from Montessori symbol key to "type code" used in exercises
// Here we align keys and expected type codes.
const KEY_TO_TYPE = {
  "N":"N",
  "ART":"ART",
  "ADJ":"ADJ",
  "V":"V",
  "ADV":"ADV",
  "PRO":"PRO",
  "PR√ÑP":"PR√ÑP",
  "KONJ":"KONJ",
  "INT":"INT"
};

function check(){
  let right=0, wrong=0, missing=0;

  document.querySelectorAll(".tok.word").forEach(w=>{
    const correct = w.dataset.correct; // e.g. "ART"
    const assignedKey = w.dataset.assigned; // e.g. "ART" (because symbol keys match type codes except N/V etc already match)
    const slot = w.querySelector(".slot");
    slot.classList.remove("ok","bad");

    if(!assignedKey){
      missing++;
      return;
    }

    const assignedType = KEY_TO_TYPE[assignedKey] || null;

    if(assignedType === correct){
      right++;
      slot.classList.add("ok");
    }else{
      wrong++;
      slot.classList.add("bad");
    }
  });

  // Score: +1 per right, -1 per wrong (min 0)
  score = Math.max(0, score + right - wrong);
  document.getElementById("score").textContent = String(score);

  lastCheck = { right, wrong };
  document.getElementById("right").textContent = String(right);
  document.getElementById("wrong").textContent = String(wrong);

  if(missing>0){
    document.getElementById("msg").innerHTML = `Du hast noch <b>${missing}</b> Wort/W√∂rter ohne Symbol. (Richtig: <b>${right}</b>, Falsch: <b>${wrong}</b>)`;
  }else{
    document.getElementById("msg").innerHTML = `Fertig gepr√ºft! Richtig: <b>${right}</b> ‚Ä¢ Falsch: <b>${wrong}</b>.`;
  }
}

function solve(){
  // Set all correct symbols
  document.querySelectorAll(".tok.word").forEach(w=>{
    const correct = w.dataset.correct;
    // symbol key equals the type code in our set (ART, ADJ, ... plus N,V)
    const symKey = Object.keys(KEY_TO_TYPE).find(k => KEY_TO_TYPE[k] === correct);
    if(symKey) assignSymbolToWord(w, symKey);
  });
  // Mark as checked
  check();
  document.getElementById("msg").innerHTML = `L√∂sung angezeigt. Schau dir an, welche W√∂rter welche Wortart haben.`;
}

/* -----------------------------
   Buttons & Navigation
------------------------------ */
document.getElementById("homeBtn").addEventListener("click", () => {
  // Zur Repo-Startseite (Root index.html)
  window.location.href = "index.html";
});
document.getElementById("newBtn").addEventListener("click", clearAssignments);
document.getElementById("nextBtn").addEventListener("click", () => {
  clearAssignments();
  loadExercise(current+1);
});
document.getElementById("checkBtn").addEventListener("click", check);
document.getElementById("solveBtn").addEventListener("click", solve);

/* -----------------------------
   Keyboard shortcuts
------------------------------ */
window.addEventListener("keydown", (e) => {
  if(e.key === "Escape"){
    setSelectedSymbol(null);
    document.querySelectorAll(".tok.word").forEach(x=>x.classList.remove("selected"));
  }
  // 1-9 selects symbol
  const n = Number(e.key);
  if(n>=1 && n<=SYMBOLS.length){
    setSelectedSymbol(SYMBOLS[n-1].key);
  }
});

/* -----------------------------
   Init
------------------------------ */
loadExercise(0);
</script>
</body>
</html>
