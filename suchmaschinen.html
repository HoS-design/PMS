<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HoS Lernapp ‚Äì Recherchieren wie ein Profi (Complete)</title>
  <style>
    /* ===================== HoS Design System ===================== */
    :root{
      --subject-color:#10b981;
      /* Helles HoS-Design (Classroom/Beamer-friendly) */
      --bg: #f2f4f7;
      --surface: #ffffff;
      --panel: #ffffff;
      --stroke: #e2e8f0;
      --ink: #1e293b;
      --muted: #64748b;
      --muted2: #94a3b8;
      --accent: #3b82f6;  /* HoS Blue */
      --warn: #f59e0b;    /* Amber */
      --good: #10b981;    /* Green */
      --radius: 18px;
      --maxw: 900px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      font-family: system-ui, -apple-system, sans-serif;
      color: var(--ink);
      background: var(--bg);
      overflow-x:hidden;
      line-height: 1.5;
    }

    .wrap{ max-width: var(--maxw); margin: 0 auto; padding: 18px 16px 80px; }
    
    /* Topbar */
    .topbar{
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: blur(12px);
      background: rgba(255,255,255,.92);
      border-bottom: 1px solid var(--stroke);
    }
    .topbar-inner{
      max-width: var(--maxw); margin: 0 auto; padding: 10px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{ font-weight:800; font-size:15px; display:flex; flex-direction:column; line-height:1.1; }
    .brand span{ color: var(--accent); font-size:11px; text-transform:uppercase; letter-spacing:1px; }

    .meme{ width:40px; height:40px; border-radius:12px; object-fit:cover;
      border:1px solid var(--stroke); background: rgba(255,255,255,.7); }

    /* UI Elements */
    .btn{
      border: 1px solid var(--stroke);
      background: var(--surface);
      color: var(--ink); padding: 9px 16px; border-radius: 12px;
      font-weight: 700; font-size: 13px; cursor:pointer;
      transition: all .1s; display:inline-flex; align-items:center; gap:6px;
    }
    .btn:hover{ transform: translateY(-1px); background: var(--bg); }
    .btn:active{ transform: scale(0.98); }
    .btn.accent{ background: var(--accent-soft); border-color: var(--accent); color: var(--ink); }
    .btn.secondary{ background: transparent; border-color: transparent; color: var(--muted); }

    .card{
      background: var(--panel); border: 1px solid var(--stroke);
      border-radius: var(--radius); overflow:hidden; margin-top:20px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.10);
    }
    .card .hd{ padding: 16px 20px; border-bottom: 1px solid var(--stroke); display:flex; justify-content:space-between; align-items:center; background: var(--bg); }
    .card .bd{ padding: 20px; }
    .card h3{ margin:0; font-size:16px; font-weight:800; }
    
    .note{ 
      background: rgba(251,191,36,.08); border: 1px dashed rgba(251,191,36,.3); 
      padding:14px; border-radius:12px; font-size:14px; color: #92400e; 
      margin-bottom:16px; display:flex; gap:10px; align-items:start;
    }
    .note b{ color: var(--ink); }

    /* Form Fields */
    .field{ margin-top:16px; display:grid; gap:6px; }
    label{ font-size:12px; color:var(--muted); font-weight:700; text-transform:uppercase; letter-spacing:.5px; }
    input, textarea{
      width:100%; background: var(--surface); border: 1px solid var(--stroke);
      color: var(--ink); padding:12px; border-radius:10px; outline:none; font-family:inherit; font-size:14px;
      transition: border-color .2s;
    }
    textarea{ min-height:80px; resize:vertical; line-height:1.4; }
    input:focus, textarea:focus{ border-color: var(--accent); background: rgba(255,255,255,1); box-shadow: 0 0 0 3px rgba(37,99,235,.12); }

    /* Chips */
    .chip{
      display:inline-block; padding:8px 14px; border-radius:20px;
      border:1px solid var(--stroke); background: var(--bg);
      margin-right:8px; margin-bottom:8px; cursor:pointer; font-size:13px; font-weight:700;
      user-select:none; transition: all .2s;
    }
    .chip:hover{ background: var(--accent-soft); }
    .chip.selected{ background: rgba(37,99,235,.12); border-color: var(--accent); color: var(--ink); box-shadow: 0 0 0 3px rgba(37,99,235,.10); }

    /* Infografiken */
    .diagram-box{
      margin: 16px 0; border-radius: 12px; overflow: hidden;
      border: 1px solid var(--stroke); background: var(--bg);
    }
    .diagram-box svg{ width:100%; height:auto; display:block; }
    .diagram-caption{ padding:8px 12px; font-size:12px; color:var(--muted); background:var(--bg); border-top:1px solid var(--stroke); }

    /* Progress */
    .progress{ height:6px; background: var(--stroke); border-radius:4px; overflow:hidden; width:120px; }
    .bar{ height:100%; background: linear-gradient(90deg, var(--accent), #22c55e); width:0%; transition:width .4s cubic-bezier(0.4, 0, 0.2, 1); }

    .feedback{ margin-top:10px; padding:12px; border-radius:10px; font-size:13px; display:none; animation: fadeIn .3s; }
    .feedback.show{ display:block; }
    .feedback.warn{ background: rgba(217,119,6,.10); color: #92400e; border:1px solid rgba(217,119,6,.25); }
    
    @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }
    .hidden{ display:none !important; }

    /* Checkliste Startseite */
    .check-list{ list-style:none; padding:0; margin:0; }
    .check-list li{ display:flex; gap:10px; padding:8px 0; border-bottom:1px solid rgba(15,23,42,0.06); font-size:14px; color:var(--muted); }
    .check-list li:last-child{ border:0; }
    .check-list span{ color: var(--accent); font-weight:bold; }

    @media print{
      body{ background:white; color:black; }
      .topbar, .btn, .note, .feedback, #start-screen, .diagram-box { display:none !important; }
      .wrap{ padding:0; max-width:100%; }
      .card{ box-shadow:none; border:none; margin:0; border-bottom:1px solid #ddd; border-radius:0; }
      .card .hd, .card .bd{ padding:10px 0; border:0; background:none; }
      .card h3{ color:#000; font-size:18px; border-bottom:1px solid #000; padding-bottom:5px; margin-bottom:10px; }
      pre{ white-space: pre-wrap; font-family: monospace; border:1px solid #ccc; padding:10px; font-size:12px; }
      h1, p, label{ color:#000; }
      input, textarea{ border:1px solid #ccc; background:white; color:black; }
    }
  
    .app-header {
      padding: 12px 24px;
      background: var(--surface);
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
      box-shadow: var(--shadow-md, 0 4px 6px -1px rgba(0,0,0,0.08), 0 2px 4px -1px rgba(0,0,0,0.04));
    }
    .app-header .brand-row { display:flex; align-items:center; gap:12px; }
    .app-header .logo-img { width:44px; height:44px; object-fit:contain; border-radius:10px; background:var(--bg); border:1px solid var(--line); }
    .app-header .badge-main {
      display:inline-flex; align-items:center;
      background: var(--subject-color);
      color: white;
      font-size:10px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px;
      padding:3px 8px; border-radius:99px;
    }

</style>
</head>
<body>

<header class="app-header">
  <div class="brand-row">
    <img src="chatisthisreal.png" alt="Logo" class="logo-img" onerror="this.style.display='none'">
    <div class="badge-main">Medien</div>
  </div>
</header>


<div class="topbar">
  <div class="topbar-inner">
    <div style="display:flex; align-items:center; gap:10px;">
      <img src="chatistthisreal.png" onerror="this.onerror=null;this.src='chatisthisreal.png';" alt="Chat is this real?" class="meme">
      <div class="brand">Lernapp<span>Recherche Profi</span></div>
    </div>
    <div style="display:flex; align-items:center; gap:16px;">
      <div style="text-align:right; font-size:11px; color:var(--muted); font-weight:700;" id="progText">START</div>
      <div class="progress"><div class="bar" id="progBar"></div></div>
      <button class="btn secondary" onclick="app.reset()" title="Neu starten">‚Ü∫</button>
      <button class="btn accent" onclick="window.print()" title="Ergebnis drucken">üñ®Ô∏è</button>
    </div>
  </div>
</div>

<div class="wrap">
  
  <div id="start-screen">
    <div class="card" style="background: linear-gradient(180deg, rgba(37,99,235,.10), rgba(255,255,255,.70)); border-color: rgba(255,255,255,.2);">
      <div class="bd" style="padding:40px 30px;">
        <h1 style="margin:0 0 15px; font-size:28px;">Recherchieren wie ein Profi</h1>
        <p style="color:var(--muted); font-size:16px; line-height:1.6; max-width:600px; margin-bottom:30px;">
          Das Internet ist voll von Informationen ‚Äì aber welche stimmen? 
          In dieser App lernst du Schritt f√ºr Schritt, wie du Quellen pr√ºfst und sauber arbeitest.
        </p>
        
        <div style="background:rgba(15,23,42,0.04); border-radius:12px; padding:20px; max-width:500px; margin-bottom:30px;">
          <h4 style="margin:0 0 10px; color: var(--ink);">Das lernst du heute:</h4>
          <ul class="check-list">
            <li><span>‚úì</span> Wie Suchmaschinen wirklich ticken</li>
            <li><span>‚úì</span> Fake News vs. Fakten erkennen</li>
            <li><span>‚úì</span> Wikipedia als Startrampe nutzen</li>
            <li><span>‚úì</span> Quellen in der Cloud sammeln</li>
          </ul>
        </div>

        <button class="btn accent" style="padding:14px 28px; font-size:16px; box-shadow: 0 4px 20px rgba(125,211,252,0.3);" onclick="app.start()">üöÄ Los geht's</button>
      </div>
    </div>
  </div>

  <div id="module-container"></div>
  
  <div id="final-summary" class="hidden card">
    <div class="hd"><h3>Dein Ergebnis (Druckansicht)</h3></div>
    <div class="bd">
      <div class="note"><b>Gl√ºckwunsch!</b> Du hast alle Module geschafft. Drucke diese Seite jetzt aus oder speichere sie als PDF.</div>
      <pre id="summary-text"></pre>
      <div style="margin-top:20px; text-align:right;">
         <button class="btn accent" onclick="window.print()">Jetzt drucken</button>
      </div>
    </div>
  </div>

</div>

<script>
const DIAGRAMS = {
  search: `
    <svg viewBox="0 0 800 200">
      <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#7dd3fc" stop-opacity="0.2"/><stop offset="1" stop-color="#a7f3d0" stop-opacity="0.2"/></linearGradient></defs>
      <rect x="0" y="0" width="800" height="200" rx="10" fill="#0f172a"/>
      
      <g transform="translate(50,50)">
        <rect x="0" y="0" width="140" height="60" rx="8" fill="#1e293b" stroke="#334155"/>
        <text x="70" y="35" fill="#fff" text-anchor="middle" font-size="12" font-weight="bold">Deine Suche</text>
        
        <path d="M150 30 H190" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
        
        <rect x="200" y="0" width="140" height="60" rx="8" fill="#1e293b" stroke="#334155"/>
        <text x="270" y="25" fill="#fff" text-anchor="middle" font-size="12" font-weight="bold">Suchmaschine</text>
        <text x="270" y="45" fill="#94a3b8" text-anchor="middle" font-size="10">Filtert Millionen Seiten</text>
        
        <path d="M350 30 H390" stroke="#64748b" stroke-width="2"/>
        
        <rect x="400" y="-20" width="200" height="100" rx="8" fill="url(#g)" stroke="#7dd3fc"/>
        <text x="500" y="20" fill="#fff" text-anchor="middle" font-size="13" font-weight="bold">Ergebnisliste</text>
        <text x="500" y="40" fill="#bae6fd" text-anchor="middle" font-size="11">Ranking nach Algorithmus</text>
        <text x="500" y="60" fill="#fbbf24" text-anchor="middle" font-size="11">‚ö†Ô∏è + Werbung / SEO</text>
      </g>
    </svg>
  `,
  traffic: `
    <svg viewBox="0 0 800 120">
      <rect x="0" y="0" width="800" height="120" rx="10" fill="#1e293b"/>
      <g transform="translate(40,30)">
        <circle cx="30" cy="30" r="20" fill="#ef4444" opacity="0.8"/>
        <text x="70" y="20" fill="#fff" font-size="13" font-weight="bold">WER?</text>
        <text x="70" y="40" fill="#94a3b8" font-size="11">Autor unbekannt? Impressum fehlt?</text>
      </g>
      <g transform="translate(290,30)">
        <circle cx="30" cy="30" r="20" fill="#f59e0b" opacity="0.8"/>
        <text x="70" y="20" fill="#fff" font-size="13" font-weight="bold">WARUM?</text>
        <text x="70" y="40" fill="#94a3b8" font-size="11">Will die Seite etwas verkaufen?</text>
      </g>
      <g transform="translate(540,30)">
        <circle cx="30" cy="30" r="20" fill="#10b981" opacity="0.8"/>
        <text x="70" y="20" fill="#fff" font-size="13" font-weight="bold">WANN?</text>
        <text x="70" y="40" fill="#94a3b8" font-size="11">Ist die Info aktuell (Datum)?</text>
      </g>
    </svg>
  `,
  wiki: `
    <svg viewBox="0 0 800 160">
      <defs><linearGradient id="w" x1="0" x2="1"><stop offset="0" stop-color="#e2e8f0" stop-opacity="0.1"/><stop offset="1" stop-color="#fff" stop-opacity="0.05"/></linearGradient></defs>
      <rect x="0" y="0" width="800" height="160" rx="10" fill="#0f172a"/>
      
      <g transform="translate(50,50)">
        <rect x="0" y="0" width="160" height="60" rx="8" fill="url(#w)" stroke="#94a3b8"/>
        <text x="80" y="35" fill="#fff" text-anchor="middle" font-size="12" font-weight="bold">1. Wikipedia Artikel</text>
        
        <path d="M170 30 H230" stroke="#64748b" stroke-width="2" stroke-dasharray="4"/>
        
        <rect x="240" y="0" width="160" height="60" rx="8" fill="#1e293b" stroke="#7dd3fc"/>
        <text x="320" y="25" fill="#fff" text-anchor="middle" font-size="12" font-weight="bold">2. Einzelnachweise</text>
        <text x="320" y="45" fill="#7dd3fc" text-anchor="middle" font-size="10">(ganz unten)</text>
        
        <path d="M410 30 H470" stroke="#7dd3fc" stroke-width="2"/>
        
        <rect x="480" y="-10" width="180" height="80" rx="8" fill="#10b981" fill-opacity="0.2" stroke="#10b981"/>
        <text x="570" y="30" fill="#fff" text-anchor="middle" font-size="13" font-weight="bold">3. Original-Quelle</text>
        <text x="570" y="50" fill="#6ee7b7" text-anchor="middle" font-size="11">Studie, Zeitungsartikel...</text>
      </g>
    </svg>
  `,
  cloud: `
    <svg viewBox="0 0 800 140">
      <rect x="0" y="0" width="800" height="140" rx="10" fill="#0f172a"/>
      <circle cx="400" cy="70" r="50" fill="#7dd3fc" opacity="0.1" stroke="#7dd3fc"/>
      <text x="400" y="75" fill="#fff" text-anchor="middle" font-size="14" font-weight="bold">Dokument</text>
      
      <circle cx="200" cy="70" r="20" fill="#cbd5e1"/>
      <path d="M230 70 H340" stroke="#94a3b8" stroke-width="2"/>
      <text x="200" y="110" fill="#94a3b8" text-anchor="middle" font-size="10">Sch√ºler A</text>

      <circle cx="600" cy="70" r="20" fill="#cbd5e1"/>
      <path d="M460 70 H570" stroke="#94a3b8" stroke-width="2"/>
      <text x="600" y="110" fill="#94a3b8" text-anchor="middle" font-size="10">Sch√ºler B</text>
      
      <text x="400" y="25" fill="#fbbf24" text-anchor="middle" font-size="11" font-weight="bold">‚ö†Ô∏è Regel: Nichts l√∂schen, was andere schreiben!</text>
    </svg>
  `
};
</script>

<script>
const app = (function(){
  
  // --- STATE ---
  const DEFAULT_STATE = {
    step: -1,
    answers: {
      m1_choice: "", m1_thought: "",
      m2_q1: "", m2_q2: "",
      m3_best: "", m3_query: "",
      m4_wiki_topic: "", m4_wiki_url: "", m4_source_title: "", m4_source_org: "", m4_source_year: "", m4_source_reason: "",
      m5_pair_mode: "", m5_doc_link: "",
      m5_sources: [
        {title:"", url:"", author:"", year:"", intent:"", why:""},
        {title:"", url:"", author:"", year:"", intent:"", why:""}
      ],
      m6_checks: {search:false, eval:false, wiki:false, cloud:false},
      m6_refl: "", m6_take: ""
    }
  };

  let state = JSON.parse(localStorage.getItem("hos_v2_final")) || JSON.parse(JSON.stringify(DEFAULT_STATE));
  const save = () => localStorage.setItem("hos_v2_final", JSON.stringify(state));

  // --- MODULES ---
  const MODULES = [
    {
      id: "m1", 
      render: () => `
        <div class="card">
          <div class="hd"><h3>Modul 1: Warm-up ü§î</h3></div>
          <div class="bd">
            <div class="note"><b>Behauptung:</b> ‚ÄûAlles, was im Internet steht, stimmt ‚Äì weil es ja gepr√ºft wird.‚Äú</div>
            
            <p style="font-size:14px;">Wie siehst du das?</p>
            <div style="margin-bottom:20px;">
              ${chip("Stimmt", "m1_choice")} ${chip("Stimmt eher", "m1_choice")}
              ${chip("Stimmt nicht", "m1_choice")} ${chip("Kommt darauf an", "m1_choice")}
            </div>
            
            <div class="field">
              <label>Deine Meinung (1 kurzer Satz)</label>
              <textarea placeholder="Ich denke, dass..." oninput="app.txt('m1_thought', this.value)">${esc(state.answers.m1_thought)}</textarea>
            </div>
            ${navButtons()}
          </div>
        </div>
      `,
      validate: () => state.answers.m1_choice && state.answers.m1_thought.length > 5
    },
    {
      id: "m2",
      render: () => `
        <div class="card">
          <div class="hd"><h3>Modul 2: Suchmaschinen üîç</h3></div>
          <div class="bd">
            <div class="diagram-box">
              ${DIAGRAMS.search}
              <div class="diagram-caption">Schaubild: Warum das 1. Ergebnis oft Werbung ist.</div>
            </div>
            
            <div class="note"><b>Merke:</b> Suchmaschinen sortieren nach Beliebtheit und Geld, nicht nach Wahrheit.</div>

            <div class="field">
              <label>Frage 1: Warum ist Platz 1 nicht immer die beste Quelle?</label>
              <input placeholder="Weil..." value="${esc(state.answers.m2_q1)}" oninput="app.txt('m2_q1', this.value)">
            </div>

            <div style="margin-top:20px;">
              <h4 style="margin-bottom:10px;">Der Quellen-Check (Ampel)</h4>
              <div class="diagram-box">${DIAGRAMS.traffic}</div>
            </div>

            <div class="field">
              <label>Frage 2: Nenne 2 Dinge, die du bei einer Quelle pr√ºfst (siehe Ampel):</label>
              <input placeholder="z.B. Autor und..." value="${esc(state.answers.m2_q2)}" oninput="app.txt('m2_q2', this.value)">
            </div>
            ${navButtons()}
          </div>
        </div>
      `,
      validate: () => state.answers.m2_q1.length > 2 && state.answers.m2_q2.length > 2
    },
    {
      id: "m3",
      render: () => `
        <div class="card">
          <div class="hd"><h3>Modul 3: Clever suchen üí°</h3></div>
          <div class="bd">
            <div class="note"><b>Profi-Tipp:</b> Nutze <i>Keywords</i> (Schlagworte) statt ganzer S√§tze. Du sprichst mit einer Maschine!</div>
            
            <p style="font-size:14px; font-weight:bold;">Beispiel-Thema: "Sollten Handys in der Schule erlaubt sein?"</p>
            <p style="font-size:13px; color:var(--muted);">Welche Suche liefert bessere (sachlichere) Ergebnisse?</p>
            
            <div style="margin-bottom:20px;">
              ${chip("A) Warum sind Handys so schlecht", "m3_best")}
              ${chip("B) Handy Schule Vorteile Nachteile Studie", "m3_best")}
            </div>
            
            <div class="field">
              <label>Deine Aufgabe: Formuliere eine eigene Keyword-Suche.</label>
              <input placeholder="Mein Suchbegriff..." value="${esc(state.answers.m3_query)}" oninput="app.txt('m3_query', this.value)">
            </div>
            ${navButtons()}
          </div>
        </div>
      `,
      validate: () => state.answers.m3_best
    },
    {
      id: "m4",
      render: () => `
        <div class="card">
          <div class="hd"><h3>Modul 4: Wikipedia richtig nutzen üß†</h3></div>
          <div class="bd">
            <div class="diagram-box">
              ${DIAGRAMS.wiki}
              <div class="diagram-caption">Der Profi-Trick: Nicht abschreiben, sondern Quellen finden.</div>
            </div>
            
            <div class="note"><b>Aufgabe:</b> Suche ein Thema auf Wikipedia. Scrolle ganz nach unten zu "Einzelnachweise". W√§hle dort eine echte Quelle aus.</div>
            
            <div class="field"><label>Dein Thema</label>
            <input value="${esc(state.answers.m4_wiki_topic)}" oninput="app.txt('m4_wiki_topic', this.value)"></div>

            <div class="field"><label>Link zum Wikipedia-Artikel</label>
            <input placeholder="https://de.wikipedia.org/..." value="${esc(state.answers.m4_wiki_url)}" oninput="app.txt('m4_wiki_url', this.value)"></div>

            <hr style="border:0; border-top:1px solid var(--stroke); margin:20px 0;">
            <p style="font-size:14px; font-weight:700; color:var(--accent);">üëá Jetzt zur Original-Quelle (aus den Einzelnachweisen):</p>

            <div class="field"><label>Titel der Quelle</label>
            <input placeholder="√úberschrift des Artikels..." value="${esc(state.answers.m4_source_title)}" oninput="app.txt('m4_source_title', this.value)"></div>

            <div class="field"><label>Organisation / Autor</label>
            <input placeholder="Wer hat das geschrieben?" value="${esc(state.answers.m4_source_org)}" oninput="app.txt('m4_source_org', this.value)"></div>

            <div class="field"><label>Jahr / Datum</label>
            <input value="${esc(state.answers.m4_source_year)}" oninput="app.txt('m4_source_year', this.value)"></div>

            <div class="field"><label>Warum wirkt diese Quelle seri√∂s?</label>
            <textarea placeholder="Weil..." oninput="app.txt('m4_source_reason', this.value)">${esc(state.answers.m4_source_reason)}</textarea></div>

            ${navButtons()}
          </div>
        </div>
      `,
      validate: () => {
        const a = state.answers;
        return a.m4_wiki_topic.length >= 2 && 
               (a.m4_wiki_url.includes(".") || a.m4_wiki_url.length>3) &&
               a.m4_source_title.length >= 1 && 
               a.m4_source_reason.length >= 2;
      }
    },
    {
      id: "m5",
      render: () => `
        <div class="card">
          <div class="hd"><h3>Modul 5: Quellen sammeln ‚òÅÔ∏è</h3></div>
          <div class="bd">
            <div class="diagram-box">
              ${DIAGRAMS.cloud}
            </div>
            <div class="note"><b>Teamwork:</b> In der Cloud arbeiten wir gemeinsam. L√∂sche niemals den Text anderer!</div>
            
            <p>Wie arbeitest du gerade?</p>
            <div style="margin-bottom:15px;">
              ${chip("üë§ Einzelarbeit", "m5_pair_mode")} ${chip("üë• Partnerarbeit", "m5_pair_mode")}
            </div>
            
            <p style="font-size:14px; font-weight:bold;">Sammle jetzt 2 gute Quellen zu deinem Thema:</p>

            ${[0,1].map(i => `
              <div style="background:rgba(255,255,255,0.03); padding:15px; border-radius:12px; border:1px solid var(--stroke); margin-bottom:15px;">
                <strong style="display:block; margin-bottom:10px; color:var(--accent);">Quelle ${i+1}</strong>
                <div class="field"><label>Titel</label><input value="${esc(state.answers.m5_sources[i].title)}" oninput="app.txtSrc(${i}, 'title', this.value)"></div>
                <div class="field"><label>URL</label><input value="${esc(state.answers.m5_sources[i].url)}" oninput="app.txtSrc(${i}, 'url', this.value)"></div>
                <div class="field"><label>Autor/Org</label><input value="${esc(state.answers.m5_sources[i].author)}" oninput="app.txtSrc(${i}, 'author', this.value)"></div>
                <div class="field"><label>Warum gut?</label><input value="${esc(state.answers.m5_sources[i].why)}" oninput="app.txtSrc(${i}, 'why', this.value)"></div>
              </div>
            `).join('')}
            
            ${navButtons()}
          </div>
        </div>
      `,
      validate: () => state.answers.m5_pair_mode && state.answers.m5_sources[0].title.length > 1 && state.answers.m5_sources[1].title.length > 1
    },
    {
      id: "m6",
      render: () => `
        <div class="card">
          <div class="hd"><h3>Abschluss: Reflexion üéâ</h3></div>
          <div class="bd">
            <div class="note"><b>Fast fertig!</b> Checke kurz ab, was du heute gelernt hast.</div>
            
            <div style="display:grid; gap:10px; margin-bottom:20px;">
              ${checkRow("Ich wei√ü, dass Suchmaschinen filtern.", "search")}
              ${checkRow("Ich wei√ü, wie ich Quellen pr√ºfe (Wer/Wann/Warum).", "eval")}
              ${checkRow("Ich nutze Wikipedia-Einzelnachweise.", "wiki")}
              ${checkRow("Ich kann Ergebnisse sauber dokumentieren.", "cloud")}
            </div>

            <div class="field">
              <label>Reflexion: Was machst du beim n√§chsten Referat anders?</label>
              <textarea placeholder="Ich werde..." oninput="app.txt('m6_refl', this.value)">${esc(state.answers.m6_refl)}</textarea>
            </div>

            <div class="field">
              <label>Mein wichtigster Satz von heute:</label>
              <input value="${esc(state.answers.m6_take)}" oninput="app.txt('m6_take', this.value)">
            </div>
            
            <div class="feedback" id="fb_msg">Bitte f√ºlle die Reflexion aus.</div>

            <div style="margin-top:25px; display:flex; gap:10px; justify-content:space-between;">
              <button class="btn secondary" onclick="app.prev()">Zur√ºck</button>
              <button class="btn accent" style="padding:12px 24px;" onclick="app.finish()">‚úÖ Fertigstellen</button>
            </div>
          </div>
        </div>
      `,
      validate: () => state.answers.m6_refl.length > 3
    }
  ];

  // --- HELPERS ---
  const esc = (txt) => (txt || "").toString().replace(/"/g, "&quot;");
  
  const chip = (lbl, key) => {
    const val = state.answers[key];
    const sel = val === lbl ? "selected" : "";
    return `<span class="chip ${sel}" onclick="app.set('${key}', '${lbl}')">${lbl}</span>`;
  };

  const checkRow = (lbl, subKey) => {
    const chk = state.answers.m6_checks[subKey] ? "checked" : "";
    return `<label style="display:flex; gap:12px; align-items:center; cursor:pointer; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;">
      <input type="checkbox" style="width:20px; height:20px;" ${chk} onchange="app.setCheck('${subKey}', this.checked)"> 
      <span style="color: var(--ink); font-size:13px;">${lbl}</span>
    </label>`;
  };

  const navButtons = () => `
    <div class="feedback" id="fb_msg">‚ö†Ô∏è Bitte f√ºlle alle Aufgaben aus, bevor du weitergehst.</div>
    <div style="margin-top:25px; display:flex; justify-content:space-between;">
      <button class="btn secondary" onclick="app.prev()">Zur√ºck</button>
      <button class="btn accent" onclick="app.next()">Weiter ‚Üí</button>
    </div>
  `;

  // --- ENGINE ---
  function render() {
    const cont = document.getElementById("module-container");
    const prog = document.getElementById("progBar");
    const progT = document.getElementById("progText");
    
    // Progress
    const pct = Math.max(0, Math.round(((state.step + 1) / MODULES.length) * 100));
    prog.style.width = state.step === -1 ? "0%" : pct + "%";
    progT.innerText = state.step === -1 ? "START" : `MODUL ${state.step + 1}/${MODULES.length}`;

    if (state.step === -1) {
      document.getElementById("start-screen").classList.remove("hidden");
      cont.innerHTML = "";
      return;
    }

    document.getElementById("start-screen").classList.add("hidden");
    const mod = MODULES[state.step];
    cont.innerHTML = mod.render();
    window.scrollTo({top:0, behavior:'smooth'});
  }

  return {
    start: () => { state.step = 0; save(); render(); },
    reset: () => { if(confirm("Wirklich neu starten? Alle Eingaben werden gel√∂scht.")) { localStorage.removeItem("hos_v2_final"); location.reload(); } },
    
    // UI Updates
    set: (key, val) => { state.answers[key] = val; save(); render(); },
    setCheck: (key, val) => { state.answers.m6_checks[key] = val; save(); render(); }, // Checkboxes need render to show state
    
    // Text Input Updates (NO RENDER to keep focus)
    txt: (key, val) => { state.answers[key] = val; save(); },
    txtSrc: (idx, field, val) => { state.answers.m5_sources[idx][field] = val; save(); },

    next: () => {
      const mod = MODULES[state.step];
      if (mod.validate()) {
        if (state.step < MODULES.length - 1) {
          state.step++;
          save();
          render();
        }
      } else {
        const fb = document.getElementById("fb_msg");
        if(fb) fb.classList.add("show", "warn");
      }
    },

    prev: () => {
      if (state.step > 0) {
        state.step--;
        save();
        render();
      } else {
        state.step = -1;
        save();
        render();
      }
    },

    finish: () => {
      const a = state.answers;
      let txt = "LERNAPP: RECHERCHIEREN WIE EIN PROFI\n";
      txt += "====================================\n";
      txt += "Sch√ºler:in Ergebnisprotokoll\n\n";
      
      txt += `MODUL 1: EINSTIEG\n`;
      txt += `‚Ä¢ Meinung: "${a.m1_choice}"\n‚Ä¢ Begr√ºndung: ${a.m1_thought}\n\n`;
      
      txt += `MODUL 2: SUCHMASCHINEN\n`;
      txt += `‚Ä¢ Platz 1 Problem: ${a.m2_q1}\n‚Ä¢ Qualit√§ts-Check: ${a.m2_q2}\n\n`;
      
      txt += `MODUL 3: KEYWORDS\n`;
      txt += `‚Ä¢ Suchbegriff: ${a.m3_query}\n\n`;
      
      txt += `MODUL 4: WIKIPEDIA\n`;
      txt += `‚Ä¢ Thema: ${a.m4_wiki_topic}\n‚Ä¢ Wiki-URL: ${a.m4_wiki_url}\n`;
      txt += `‚Ä¢ Gefundene Quelle: ${a.m4_source_title} (${a.m4_source_year})\n‚Ä¢ Autor/Org: ${a.m4_source_org}\n‚Ä¢ Seri√∂s weil: ${a.m4_source_reason}\n\n`;
      
      txt += `MODUL 5: QUELLENSAMMLUNG\n`;
      a.m5_sources.forEach((s,i) => {
        txt += `[Quelle ${i+1}] ${s.title}\n  URL: ${s.url}\n  Autor: ${s.author}\n  Warum gut: ${s.why}\n`;
      });
      
      txt += `\nMODUL 6: REFLEXION\n`;
      txt += `‚Ä¢ Vorsatz: ${a.m6_refl}\n‚Ä¢ Wichtigstes Learning: ${a.m6_take}`;

      document.getElementById("summary-text").innerText = txt;
      document.getElementById("final-summary").classList.remove("hidden");
      document.getElementById("module-container").innerHTML = ""; 
      window.scrollTo({top:0});
    }
  };
})();

// Init
app.render = function(){};
if(localStorage.getItem("hos_v2_final")) app.start();
</script>
</body>
</html>
